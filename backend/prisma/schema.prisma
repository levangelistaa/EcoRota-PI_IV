generator client {
  provider = "prisma-client"
  output   = "./generated/client"
}

datasource ecorota {
  provider = "mysql"
}

model Administrador {
  id            Int      @id @default(autoincrement())
  name          String
  email         String   @unique
  password      String
  creation_date DateTime @default(now())
  update_date   DateTime @updatedAt

  created_routes        Route[]        @relation("RouteCreatedBy")
  updated_routes        Route[]        @relation("RouteUpdatedBy")
  created_neighborhoods Neighborhood[] @relation("NeighborhoodCreatedBy")
  updated_neighborhoods Neighborhood[] @relation("NeighborhoodUpdatedBy")
  created_ecopoints     Ecopoint[]     @relation("EcopointCreatedBy")
  updated_ecopoints     Ecopoint[]     @relation("EcopointUpdatedBy")
  resolved_problems     ReportedProblem[] @relation("ProblemResolvedBy")

  @@map("administradores")
}

model Route {
  id              Int      @id @default(autoincrement())
  name            String
  days_of_week    String
  collection_type String
  start_time      DateTime
  end_time        DateTime
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  admin_id_created Int
  created_by       Administrador @relation("RouteCreatedBy", fields: [admin_id_created], references: [id])

  admin_id_updated Int?
  updated_by       Administrador? @relation("RouteUpdatedBy", fields: [admin_id_updated], references: [id])

  neighborhoods Neighborhood[]

  @@map("routes")
}

model Neighborhood {
  id                  Int      @id @default(autoincrement())
  name                String
  latitude            Float
  longitude           Float
  cep                 String
  population_estimate Int?
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt

  route_id Int
  route    Route @relation(fields: [route_id], references: [id])

  admin_id_created Int
  created_by       Administrador @relation("NeighborhoodCreatedBy", fields: [admin_id_created], references: [id])

  admin_id_updated Int?
  updated_by       Administrador? @relation("NeighborhoodUpdatedBy", fields: [admin_id_updated], references: [id])

  subscribers Subscriber[]
  ecopoints   Ecopoint[]

  @@map("neighborhoods")
}

model Subscriber {
  id         Int      @id @default(autoincrement())
  email      String   @unique
  street     String
  number     String?
  complement String?
  postal_code String?
  latitude   Float?
  longitude  Float?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  neighborhood_id Int
  neighborhood    Neighborhood @relation(fields: [neighborhood_id], references: [id])

  reported_problems ReportedProblem[]

  @@index([neighborhood_id])
  @@map("subscribers")
}

model Ecopoint {
  id                 Int      @id @default(autoincrement())
  name               String
  street             String
  number             String?
  complement         String?
  postal_code        String?
  latitude           Float?
  longitude          Float?
  accepted_materials String
  collection_days    String
  collection_time    String
  created_at         DateTime @default(now())
  updated_at         DateTime @updatedAt

  neighborhood_id Int
  neighborhood    Neighborhood @relation(fields: [neighborhood_id], references: [id])

  admin_id_created Int
  created_by       Administrador @relation("EcopointCreatedBy", fields: [admin_id_created], references: [id])

  admin_id_updated Int?
  updated_by       Administrador? @relation("EcopointUpdatedBy", fields: [admin_id_updated], references: [id])

  @@index([neighborhood_id])
  @@map("ecopoints")
}

model ReportedProblem {
  id                 Int      @id @default(autoincrement())
  problem_type       String
  description        String
  status             String
  url_attachments    String
  protocol           String
  created_at         DateTime @default(now())
  updated_at         DateTime @updatedAt

  subscriber_id Int
  subscriber    Subscriber @relation(fields: [subscriber_id], references: [id])

  resolved_by_admin_id Int?
  resolved_by          Administrador? @relation("ProblemResolvedBy", fields: [resolved_by_admin_id], references: [id])

  @@index([status])
  @@index([protocol])
  @@index([subscriber_id])
  @@map("reported_problems")
}
